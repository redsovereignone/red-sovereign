---
import { site, navLinks } from "@/data/site";

const year = new Date().getFullYear();

const quickLinks = [...navLinks];

const connectLinks = [
  { label: site.email, href: `mailto:${site.email}` },
  { label: "LinkedIn", href: site.linkedin, external: true },
  { label: "X / Twitter", href: site.twitter, external: true },
  { label: "Book a Call", href: site.booking, external: true },
];

const legalLinks = [
  { label: "Privacy Policy", href: "/privacy/" },
  { label: "Terms of Service", href: "/terms/" },
];
---

<footer class="border-t border-red/20 py-20 px-10 max-md:py-12 max-md:px-6">
  <div class="max-w-[1200px] mx-auto">
    <!-- Newsletter Signup -->
    <div class="mb-14 max-md:mb-10">
      <div class="max-w-[480px]">
        <a href="/">
          <img src="/logo.png" alt={site.name} class="h-7 w-auto" />
        </a>
        <p class="text-cream-dim text-sm leading-relaxed mt-4 mb-5">
          AI insights for business leaders. Get strategy breakdowns, use cases,
          and no-fluff guidance delivered to your inbox.
        </p>
        <form id="newsletter-form" class="flex gap-2 max-sm:flex-col">
          <input
            type="email"
            name="email"
            required
            placeholder="you@company.com"
            autocomplete="email"
            class="flex-1 bg-surface-2 border border-cream/[0.08] rounded-sm px-4 py-3 text-sm text-cream placeholder:text-cream-dim/60 focus:outline-none focus:border-red/50 transition-colors duration-300"
          />
          <button
            type="submit"
            class="bg-red text-cream py-3 px-6 font-display font-bold text-[0.8rem] tracking-[0.06em] uppercase rounded-sm hover:bg-red-glow hover:shadow-[0_4px_40px_rgba(200,16,46,0.3)] hover:-translate-y-px transition-all duration-300 whitespace-nowrap"
          >
            Subscribe
          </button>
        </form>
        <p
          id="newsletter-success"
          class="hidden text-sm mt-3 text-green-400"
        >
          You're in! Check your inbox to confirm.
        </p>
        <p
          id="newsletter-error"
          class="hidden text-sm mt-3 text-red-glow"
        >
          Something went wrong. Please try again.
        </p>
        <p class="text-cream-dim/40 text-xs mt-3">
          No spam. Unsubscribe anytime.
        </p>
      </div>
    </div>

    <div class="grid md:grid-cols-3 gap-12 max-md:gap-8">
      <!-- Column 1: Quick Links -->
      <div>
        <h4
          class="text-cream-dim text-xs font-medium uppercase tracking-[0.1em] mb-4"
        >
          Navigate
        </h4>
        <ul class="list-none flex flex-col gap-3">
          {
            quickLinks.map((link) => (
              <li>
                <a
                  href={link.href}
                  class="text-cream-muted text-sm no-underline hover:text-cream transition-colors duration-300"
                >
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>

      <!-- Column 2: Connect -->
      <div>
        <h4
          class="text-cream-dim text-xs font-medium uppercase tracking-[0.1em] mb-4"
        >
          Connect
        </h4>
        <ul class="list-none flex flex-col gap-3">
          {
            connectLinks.map((link) => (
              <li>
                <a
                  href={link.href}
                  target={link.external ? "_blank" : undefined}
                  rel={link.external ? "noopener noreferrer" : undefined}
                  class="text-cream-muted text-sm no-underline hover:text-cream transition-colors duration-300"
                >
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>

      <!-- Column 3: Legal -->
      <div>
        <h4
          class="text-cream-dim text-xs font-medium uppercase tracking-[0.1em] mb-4"
        >
          Legal
        </h4>
        <ul class="list-none flex flex-col gap-3">
          {
            legalLinks.map((link) => (
              <li>
                <a
                  href={link.href}
                  class="text-cream-muted text-sm no-underline hover:text-cream transition-colors duration-300"
                >
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>
    </div>

    <!-- Divider -->
    <div class="h-px bg-cream/[0.06] mt-12 mb-6"></div>

    <!-- Copyright -->
    <p class="text-cream-dim text-xs text-center">
      &copy; {year} Red Sovereign LLC. All rights reserved.
    </p>
  </div>
</footer>

<script>
  const form = document.getElementById("newsletter-form") as HTMLFormElement;
  const success = document.getElementById("newsletter-success")!;
  const error = document.getElementById("newsletter-error")!;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = new FormData(form).get("email") as string;
    const button = form.querySelector("button")!;
    const originalText = button.textContent;

    button.textContent = "Sendingâ€¦";
    button.disabled = true;
    success.classList.add("hidden");
    error.classList.add("hidden");

    try {
      const res = await fetch("/api/newsletter", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email }),
      });

      if (!res.ok) throw new Error("Request failed");

      form.classList.add("hidden");
      success.classList.remove("hidden");
    } catch {
      error.classList.remove("hidden");
    } finally {
      button.textContent = originalText;
      button.disabled = false;
    }
  });
</script>
