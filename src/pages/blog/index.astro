---
import BaseLayout from "@/layouts/BaseLayout.astro";
import JsonLd from "@/components/astro/JsonLd.astro";
import { getCollection, render } from "astro:content";
import { webPageSchema } from "@/lib/schemas";
import { site } from "@/data/site";

const posts = (
  await getCollection("blog", ({ data }) => {
    return import.meta.env.PROD ? !data.draft : true;
  })
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const readingTimes: Record<string, string> = {};
for (const post of posts) {
  const { remarkPluginFrontmatter } = await render(post);
  readingTimes[post.id] = remarkPluginFrontmatter.minutesRead;
}
---

<BaseLayout
  title="Blog"
  description="Insights on AI strategy, automation, and building AI-capable organizations from Red Sovereign."
>
  <JsonLd
    schema={webPageSchema({
      name: "Red Sovereign Blog",
      description:
        "Insights on AI strategy, automation, and building AI-capable organizations.",
      url: `${site.url}/blog`,
    })}
  />

  <section class="pt-40 pb-28 px-10 max-md:pt-28 max-md:pb-16 max-md:px-6">
    <div class="max-w-[800px] mx-auto">
      <div class="section-tag">Blog</div>
      <h1
        class="font-display text-[clamp(2.4rem,5vw,4rem)] font-extrabold leading-[1.1] tracking-tight mb-16"
      >
        Thinking out <span class="text-red">loud.</span>
      </h1>

      {
        posts.length > 0 ? (
          <div class="space-y-8">
            {posts.map((post) => (
              <a
                href={`/blog/${post.id}`}
                class="block p-8 border border-cream/[0.06] rounded-sm bg-surface hover:border-red/30 transition-colors duration-300 no-underline"
              >
                <div class="flex items-center gap-3 text-cream-dim text-[0.8rem] font-display tracking-[0.1em] uppercase">
                  <time datetime={post.data.pubDate.toISOString()}>
                    {post.data.pubDate.toLocaleDateString("en-US", {
                      year: "numeric",
                      month: "long",
                      day: "numeric",
                    })}
                  </time>
                  <span aria-hidden="true">&middot;</span>
                  <span>{readingTimes[post.id]}</span>
                </div>
                <h2 class="font-display text-xl font-bold mt-2 mb-2 text-cream">
                  {post.data.title}
                </h2>
                <p class="text-cream-muted text-[0.95rem]">
                  {post.data.description}
                </p>
                {post.data.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2 mt-3">
                    {post.data.tags.map((tag: string) => (
                      <span class="text-[0.7rem] font-display tracking-wide uppercase text-cream-dim border border-cream/[0.06] rounded-full px-2.5 py-0.5">
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </a>
            ))}
          </div>
        ) : (
          <p class="text-cream-muted font-serif text-lg">
            Posts coming soon. In the meantime,{" "}
            <a
              href="/#review"
              class="text-red hover:text-red-glow transition-colors"
            >
              take the AI Possibilities Review
            </a>{" "}
            to see what AI can do for your business.
          </p>
        )
      }
    </div>
  </section>
</BaseLayout>
